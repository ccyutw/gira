var Github=function(){this.REPO_BASE="https://api.github.com/",this.access_token=localStorage.getItem("access_token")};Github.prototype={getAccessToken:function(){var a=/\?code=([^\/]+)\/?/;if(window.location.search&&a.test(window.location.search)){var b=a.exec(location.search);return Q($.ajax({url:"http://query.yahooapis.com/v1/public/yql?q=env%20%22store%3A%2F%2F0zaLUaPXLo4GWBb1koVqO6%22%3Bselect%20OAuth%20from%20github%20where%20CODE%3D%22"+b.pop()+"%22&format=json&diagnostics=true&callback=?",type:"GET",dataType:"json"})).then(function(a){localStorage.setItem("access_token",a.query.results.token.OAuth.access_token),location.search=""},function(a){console.log("invalid code",a)})}return Q()},getUser:function(){return Q($.ajax({url:this.REPO_BASE+"user?access_token="+this.access_token,type:"GET",dataType:"json"}))},getReposUrl:function(a,b){return this.REPO_BASE+"repos/"+a+"/"+b},checkLogin:function(){return localStorage.getItem("access_token")?(this.access_token=localStorage.getItem("access_token"),!0):!1},logout:function(){localStorage.remove("access_token"),location.reload()},getLabels:function(a,b){return Q($.ajax({url:this.getReposUrl(a,b)+"/labels",type:"GET",dataType:"json"}))},getMilestones:function(a,b){return Q($.ajax({url:this.getReposUrl(a,b)+"/milestones",type:"GET",dataType:"json"}))},getIssues:function(a,b,c,d){return d="undefined"!=typeof d&&null!==d?d:"",Q($.ajax({url:this.getReposUrl(a,b)+"/issues"+(d&&"/"+d)+(c&&"?milestone="+c),type:"GET",dataType:"json"}))},getRepos:function(){return Q($.ajax({url:this.REPO_BASE+"user/repos",data:{access_token:this.access_token},type:"get",dataType:"json"}))},addLabel:function(a,b,c,d){$.ajax({url:this.REPO_BASE+["repos",a,b,"issues",c,"labels"].join("/")+"?access_token="+this.access_token,type:"put",data:JSON.stringify([d]),dataType:"json"})},createLabel:function(a,b,c){return Q($.ajax({url:this.REPO_BASE+["repos",a,b,"labels"].join("/")+"?access_token="+this.access_token,type:"post",data:JSON.stringify(c),dataType:"json"}))},deleteLabel:function(a,b,c,d){$.ajax({url:this.REPO_BASE+["repos",a,b,"issues",c,"labels",d].join("/")+"?access_token="+this.access_token,type:"delete"})},newIssue:function(a,b,c,d){return d="undefined"!=typeof d&&null!==d?d:"",Q($.ajax({url:this.REPO_BASE+["repos",a,b,"issues"].join("/")+(d&&"/"+d)+"?access_token="+this.access_token,type:"post",dataType:"json",data:JSON.stringify(c)}))}};